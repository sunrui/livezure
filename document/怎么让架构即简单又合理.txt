2012_12_4 再说服务器构架。

客户端希望看到的是，当前一共配置了多少个设备，有多少个上线了。
下面就是分析。

在服务器需要静态的加入数据库。
加入的字段大致为
（unique id, unique sign) comment, plugin,dvr_name,channel, ip, port, user/pwd

然后就是由 agent 端，静态配置好。然后通知 server 一个上线了。
agent 向服务器发送一个成功上线的 id（必须是 uid）。
然后 agent 与 server 保持心跳。（包括 id 的添加、删除）。
其中添加会报出来（非法的id or sign）
（服务器对上线的设备，可以预览一下连接情况）

现在做的一组，手动添加任务的，为本地的策略。
还有一种是服务器分配过来的任务。
（服务器可以随时叫停，或者开启任务）。

流程：

agent
一连接到服务器，马上从服务器下载和本agent有关的任务。
例如说，打开汉邦 192.168.1.110/0 通道的任务。（是不是出错了继续尝试，这个 tag)
等待服务器分配任务。
如果哪个设备突然停止了，要告之服务器。

存储 
一连接到服务器，做以下几个事情，
1. 报告当前可以使用的硬盘大小。
2. 取得当前有录像的设备。以及时段。
3. 添加录像任务，从agent给的一个远程hls地址。

客户端：
上线至服务器
1. 索引出来所有的 agent 和存储服务器。
2. 实时的查看任何一个 agent 下的任务。
3. 实时的查看任务一个存储下的任务。


